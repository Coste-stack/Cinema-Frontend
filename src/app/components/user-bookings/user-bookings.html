@if (loading()) {
  <p>Loading booking history...</p>
}

@if (error()) {
  <p class="error">{{ error() }}</p>
}

<div id="booking-list">
  @for (booking of userBookings(); track booking.id) {
    <div class="booking">
      <div class="booking-top">
        <h3>Booking #{{ booking.id }}</h3>
        <div class="booking-total">
          <div class="total-discounted">
            <strong>Total:</strong>
            <span class="price">
              {{ getTotalPrice(booking.id) }} PLN
            </span>
          </div>
          <div class="total-base">
            (was {{ getSubtotalPrice(booking.id) }} PLN)
          </div>
        </div>
      </div>

      <div class="screening">
        <p>
          <strong>Movie:</strong>
          {{ booking.screening.movie.title }}
        </p>
        <p>
          <strong>Start:</strong>
          {{ booking.screening.startTime }}
        </p>
        <p>
          <strong>End:</strong>
          {{ booking.screening.endTime }}
        </p>
        <p>
          <strong>Projection:</strong>
          {{ booking.screening.projectionType }}
          @if (booking.screening.language) {
            <span> {{ booking.screening.language }}</span>
          }
        </p>
      </div>

      <button
        class="booking-separator"
        (click)="toggleTickets(booking.id)"
      >
        <span class="icon">
          {{ isCollapsed(booking.id) ? 'Show tickets ▸' : 'Hide tickets ▾' }}
        </span>
      </button>

      <div
        class="ticket-list"
        [class.collapsed]="isCollapsed(booking.id)"
        [attr.aria-hidden]="isCollapsed(booking.id) ? 'true' : 'false'"
      >
        @for (ticket of booking.tickets; track ticket.id) {
          <div class="ticket">
            <div class="ticket-top">
              <p class="person"><strong>Person:</strong> {{ ticket.personType }}</p>
              <p class="price">
                {{ getTicketPrice(booking.id, ticket.id) }} PLN
              </p>
            </div>
            <p class="seat">
              <strong>Seat:</strong>
              Row {{ ticket.seat.row }},
              Number {{ ticket.seat.number }}
              ({{ ticket.seat.seatType }})
            </p>
            <p class="type">
              <strong>Type:</strong>
              {{ ticket.seat.seatType }}
            </p>
          </div>
        }
      </div>
    </div>
  }
</div>
